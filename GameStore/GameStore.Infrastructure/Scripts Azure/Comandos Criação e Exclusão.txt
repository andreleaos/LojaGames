# efetuando o login
az login

#Definindo a subscription
az account set --subscription 1fb41156-2ec9-455e-b554-4d344b87759f

#deletetando um resorce group
az group delete --name rg-GameStoresTech

# criando um resorce group
az group create --name rg-GameStoresTech --location brazilsouth

#criando um service plan em um resource group
az appservice plan create --name asp-GameStoresTech --resource-group rg-GameStoresTech --sku FREE

#criando uma web app
az webapp create --name GameStoresTech --plan asp-GameStoresTech --resource-group rg-GameStoresTech --runtime dotnet:6

#criando uma web app - para a API
az webapp create --name GameStoresTechApi --plan asp-GameStoresTech --resource-group rg-GameStoresTech --runtime dotnet:6


#criando um storage account
az storage account create --name gamestorestech --resource-group rg-GameStoresTech --location brazilsouth --sku Standard_LRS 

#criando um container blob
az storage container create --account-name gamestorestech --name images --public-access blob

#configurando chaves e valores no appsettings do webapp
az webapp config appsettings set --resource-group rg-GameStoresTech --name GameStoresTech --settings ASPNETCORE_ENVIRONMENT="Development"


#configurando chaves e valores no appsettings do webapp -API
az webapp config appsettings set --resource-group rg-GameStoresTech --name GameStoresTechApi --settings ConnectionStorageAccount="DefaultEndpointsProtocol=https;AccountName=gamestorestech;AccountKey=ZxQqw3/ga8V8Fbsi9u068vzd++DXYg8hBEelrdKxhqa8F/aZIwUDLLVDTNSKD4ofkdxCjRMBEVSY+AStPN5DIA==;EndpointSuffix=core.windows.net"
az webapp config appsettings set --resource-group rg-GameStoresTech --name GameStoresTechApi --settings ContainerBlobStorage="images"
az webapp config appsettings set --resource-group rg-GameStoresTech --name GameStoresTechApi --settings ASPNETCORE_ENVIRONMENT="Development"


#criando um Server
az sql server create --name gamestorestech --resource-group rg-GameStoresTech --location brazilsouth --admin-user xxxx --admin-password 123@xxxxx

#liberando acesso do ip para o servidor
az sql server firewall-rule create --resource-group rg-GameStoresTech --server gamestorestech --name AllowYourIp --start-ip-address 187.56.221.0 --end-ip-address 187.56.221.255

#liberar ip para a aplicação consumir o BD após publicado
az sql server firewall-rule create --resource-group rg-GameStoresTech --server gamestorestech --name AllowYourIp --start-ip-address 191.235.228.37 --end-ip-address 191.235.228.37


#criando SQL DataBase
az sql db create --resource-group rg-GameStoresTech --server gamestorestech --name LojaGamesDB --backup-storage-redundancy Local --sample-name AdventureWorksLT --edition GeneralPurpose --compute-model Serverless --family Gen5 --capacity 2

#obtendo a connection string sql server
az sql db show-connection-string --server gamestorestech --name LojaGamesDB --client ado.net

#configurando connection string no webapp
az webapp config connection-string set --resource-group rg-GameStoresTech --name GameStoresTech --connection-string-type SQLServer --settings lojaGamesDB='Server=tcp:gamestorestech.database.windows.net,1433;Initial Catalog=LojaGamesDB;Persist Security Info=False;User ID=fernando;Password=123@Mudar;MultipleActiveResultSets=False;Encrypt=true;TrustServerCertificate=False;Connection Timeout=30;'

#configurando connection string no webapp - API
az webapp config connection-string set --resource-group rg-GameStoresTech --name GameStoresTechApi --connection-string-type SQLServer --settings lojaGamesDB='Server=tcp:gamestorestech.database.windows.net,1433;Initial Catalog=LojaGamesDB;Persist Security Info=False;User ID=fernando;Password=123@Mudar;MultipleActiveResultSets=False;Encrypt=true;TrustServerCertificate=False;Connection Timeout=30;'


#obtendo a connection string do blob storage
az storage account show-connection-string --resource-group rg-GameStoresTech --name gamestorestech

